<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>3 Unit Testing Tag Libraries 3.3.1.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Grails Test Mixins Plugin
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestingControllers.html"><strong>2</strong><span>Unit Testing Controllers</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestingTagLibraries.html"><strong>3</strong><span>Unit Testing Tag Libraries</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestingDomains.html"><strong>4</strong><span>Unit Testing Domains</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestingFilters.html"><strong>5</strong><span>Unit Testing Filters</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestingURLMappings.html"><strong>6</strong><span>Unit Testing URL Mappings</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/mockingCollaborators.html"><strong>7</strong><span>Mocking Collaborators</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/mockingCodecs.html"><strong>8</strong><span>Mocking Codecs</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestMetaprogramming.html"><strong>9</strong><span>Unit Test Metaprogramming</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/unitTestingControllers.html">&lt;&lt; <strong>2</strong><span>Unit Testing Controllers</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/unitTestingDomains.html"><strong>4</strong><span>Unit Testing Domains</span> >></a></div>
                


                <div class="project">
                    <h1>3 Unit Testing Tag Libraries</h1>

                    <p><strong>Version:</strong> 3.3.1.BUILD-SNAPSHOT</p>
                </div>

                

                

<h1 id="unitTestingTagLibraries">3 Unit Testing Tag Libraries</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-plugins/grails-test-mixin-plugin/edit/master/src/main/docs/guide/unitTestingTagLibraries.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_the_basics">The Basics</h4>
<div class="paragraph">
<p>Tag libraries and GSP pages can be tested with the <code>grails.test.mixin.web.GroovyPageUnitTestMixin</code> mixin. To use the mixin declare which tag library is under test with the <code>TestFor</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(SimpleTagLib)
<span class="type">class</span> <span class="class">SimpleTagLibSpec</span> <span class="directive">extends</span> Specification {

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test something</span><span class="delimiter">&quot;</span></span>() {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding the <code>TestFor</code> annotation to a TagLib class causes a new <code>tagLib</code> field to be automatically created for the TagLib class under test.
The tagLib field can be used to test calling tags as function calls. The return value of a function call is either a <a href="http://docs.grails.org/3.3.1.BUILD-SNAPSHOT/api/org/grails/buffer/StreamCharBuffer.html">StreamCharBuffer</a> instance or
the object returned from the tag closure when <a href="theWebLayer.html#tagReturnValue">returnObjectForTags</a> feature is used.</p>
</div>
<div class="paragraph">
<p>Note that if you are testing invocation of a custom tag from a controller you can combine the <code>ControllerUnitTestMixin</code> and the <code>GroovyPageUnitTestMixin</code> using the <code>Mock</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="keyword">import</span> <span class="include">grails.test.mixin.Mock</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(SimpleController)
<span class="annotation">@Mock</span>(SimpleTagLib)
<span class="type">class</span> <span class="class">SimpleControllerSpec</span> <span class="directive">extends</span> Specification {

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_custom_tags">Testing Custom Tags</h4>
<div class="paragraph">
<p>The core Grails tags don&#8217;t need to be enabled during testing, however custom tag libraries do. The <code>GroovyPageUnitTestMixin</code> class provides a <code>mockTagLib()</code> method that you can use to mock a custom tag library. For example consider the following tag library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">SimpleTagLib</span> {

    <span class="directive">static</span> namespace = <span class="string"><span class="delimiter">'</span><span class="content">s</span><span class="delimiter">'</span></span>

    <span class="keyword">def</span> hello = { attrs, body -&gt;
        out &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">${</span>attrs.name ?: <span class="string"><span class="delimiter">'</span><span class="content">World</span><span class="delimiter">'</span></span><span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }

    <span class="keyword">def</span> bye = { attrs, body -&gt;
        out &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Bye </span><span class="inline"><span class="inline-delimiter">${</span>attrs.author.name ?: <span class="string"><span class="delimiter">'</span><span class="content">World</span><span class="delimiter">'</span></span><span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can test this tag library by using <code>TestFor</code> and supplying the name of the tag library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(SimpleTagLib)
<span class="type">class</span> <span class="class">SimpleTagLibSpec</span> <span class="directive">extends</span> Specification {

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test hello tag</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        applyTemplate(<span class="string"><span class="delimiter">'</span><span class="content">&lt;s:hello /&gt;</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>
        applyTemplate(<span class="string"><span class="delimiter">'</span><span class="content">&lt;s:hello name=&quot;Fred&quot; /&gt;</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">Hello Fred</span><span class="delimiter">'</span></span>
        applyTemplate(<span class="string"><span class="delimiter">'</span><span class="content">&lt;s:bye author=&quot;${author}&quot; /&gt;</span><span class="delimiter">'</span></span>, [<span class="key">author</span>: <span class="keyword">new</span> Author(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Fred</span><span class="delimiter">'</span></span>)]) == <span class="string"><span class="delimiter">'</span><span class="content">Bye Fred</span><span class="delimiter">'</span></span>
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test tag calls</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        tagLib.hello().toString() == <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>
        tagLib.hello(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Fred</span><span class="delimiter">'</span></span>).toString() == <span class="string"><span class="delimiter">'</span><span class="content">Hello Fred</span><span class="delimiter">'</span></span>
        tagLib.bye(<span class="key">author</span>: <span class="keyword">new</span> Author(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Fred</span><span class="delimiter">'</span></span>)).toString == <span class="string"><span class="delimiter">'</span><span class="content">Bye Fred</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use the <code>TestMixin</code> annotation and mock multiple tag libraries using the <code>mockTagLib()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="keyword">import</span> <span class="include">grails.test.mixin.TestMixin</span>
<span class="keyword">import</span> <span class="include">grails.test.mixin.web.GroovyPageUnitTestMixin</span>

<span class="annotation">@TestMixin</span>(GroovyPageUnitTestMixin)
<span class="type">class</span> <span class="class">MultipleTagLibSpec</span> <span class="directive">extends</span> Specification {

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test multiple tags</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        mockTagLib(SomeTagLib)
        mockTagLib(SomeOtherTagLib)

        <span class="key">expect</span>:
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>GroovyPageUnitTestMixin</code> provides convenience methods for asserting that the template output equals or matches an expected value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.test.mixin.TestFor</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(SimpleTagLib)
<span class="type">class</span> <span class="class">SimpleTagLibSpec</span> <span class="directive">extends</span> Specification {

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test hello tag</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        assertOutputEquals (<span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">&lt;s:hello /&gt;</span><span class="delimiter">'</span></span>)
        assertOutputMatches (<span class="regexp"><span class="delimiter">/</span><span class="content">.*Fred.*</span><span class="delimiter">/</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">&lt;s:hello name=&quot;Fred&quot; /&gt;</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_view_and_template_rendering">Testing View and Template Rendering</h4>
<div class="paragraph">
<p>You can test rendering of views and templates in <code>grails-app/views</code> via the <code>render(Map)</code> method provided by <code>GroovyPageUnitTestMixin</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="keyword">import</span> <span class="include">grails.test.mixin.TestMixin</span>
<span class="keyword">import</span> <span class="include">grails.test.mixin.web.GroovyPageUnitTestMixin</span>

<span class="annotation">@TestMixin</span>(GroovyPageUnitTestMixin)
<span class="type">class</span> <span class="class">RenderingSpec</span> <span class="directive">extends</span> Specification {

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test rendering template</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:
        <span class="keyword">def</span> result = render(<span class="key">template</span>: <span class="string"><span class="delimiter">'</span><span class="content">/simple/hello</span><span class="delimiter">'</span></span>)

        <span class="key">then</span>:
        result == <span class="string"><span class="delimiter">'</span><span class="content">Hello World!</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will attempt to render a template found at the location <code>grails-app/views/simple/_hello.gsp</code>. Note that if the template depends on any custom tag libraries you need to call <code>mockTagLib</code> as described in the previous section.</p>
</div>
<div class="paragraph">
<p>Some core tags use the active controller and action as input. In GroovyPageUnitTestMixin tests, you can manually set the active controller and action name by setting controllerName and actionName properties on the webRequest object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">webRequest.controllerName = <span class="string"><span class="delimiter">'</span><span class="content">simple</span><span class="delimiter">'</span></span>
    webRequest.actionName = <span class="string"><span class="delimiter">'</span><span class="content">hello</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/unitTestingControllers.html">&lt;&lt; <strong>2</strong><span>Unit Testing Controllers</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/unitTestingDomains.html"><strong>4</strong><span>Unit Testing Domains</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
