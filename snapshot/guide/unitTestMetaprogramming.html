<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>9 Unit Test Metaprogramming 3.3.1.BUILD-SNAPSHOT</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Grails Test Mixins Plugin
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestingControllers.html"><strong>2</strong><span>Unit Testing Controllers</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestingTagLibraries.html"><strong>3</strong><span>Unit Testing Tag Libraries</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestingDomains.html"><strong>4</strong><span>Unit Testing Domains</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestingFilters.html"><strong>5</strong><span>Unit Testing Filters</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestingURLMappings.html"><strong>6</strong><span>Unit Testing URL Mappings</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/mockingCollaborators.html"><strong>7</strong><span>Mocking Collaborators</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/mockingCodecs.html"><strong>8</strong><span>Mocking Codecs</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/unitTestMetaprogramming.html"><strong>9</strong><span>Unit Test Metaprogramming</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/mockingCodecs.html">&lt;&lt; <strong>8</strong><span>Mocking Codecs</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                


                <div class="project">
                    <h1>9 Unit Test Metaprogramming</h1>

                    <p><strong>Version:</strong> 3.3.1.BUILD-SNAPSHOT</p>
                </div>

                

                

<h1 id="unitTestMetaprogramming">9 Unit Test Metaprogramming</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-plugins/grails-test-mixin-plugin/edit/master/src/main/docs/guide/unitTestMetaprogramming.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If runtime metaprogramming needs to be done in a unit test it needs to be done early in the process before the unit testing environment is fully initialized.  This should be done when the unit test class is being initialized.  For a Spock based test this should be done in the <code>setupSpec()</code> method.  For a JUnit test this should be done in a method marked with <code>@BeforeClass</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> myapp

<span class="keyword">import</span> <span class="include">grails.test.mixin.*</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@TestFor</span>(SomeController)
<span class="type">class</span> <span class="class">SomeControllerSpec</span> <span class="directive">extends</span> Specification {


    <span class="keyword">def</span> <span class="function">setupSpec</span>() {
        SomeClass.metaClass.someMethod = { -&gt;
            <span class="comment">// do something here</span>
        }
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> myapp

<span class="keyword">import</span> <span class="include">grails.test.mixin.*</span>
<span class="keyword">import</span> <span class="include">org.junit.*</span>

<span class="annotation">@TestFor</span>(SomeController)
<span class="type">class</span> <span class="class">SomeControllerTests</span> {

    <span class="annotation">@BeforeClass</span>
    <span class="directive">static</span> <span class="type">void</span> metaProgramController() {
        SomeClass.metaClass.someMethod = { -&gt;
            <span class="comment">// do something here</span>
        }
    }

    <span class="comment">// ...</span>

}</code></pre>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/mockingCodecs.html">&lt;&lt; <strong>8</strong><span>Mocking Codecs</span></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
